{% extends "bootstrap/base.html" %}

{% block title %}DMA | Openlayer {% endblock %}

<!-- head -->
{% block head %}
    {{ super() }}
    <link href="{{ url_for('static',filename='assets/ol3/ol.css') }}" rel="stylesheet">
    <link href="{{ url_for('static',filename='css/sample.css') }}" rel="stylesheet">
    
    <script type="text/javascript">
		var dlzxcUrl = "{{ url_for('main.dlzxc') }}";
	</script>
    
{% endblock %}

  {% block content %}
    <div id="map" class="map"></div>
   
    <script src="{{ url_for('static',filename='assets/ol3/ol.js') }} "></script>
    <script src="{{ url_for('static',filename='assets/jquery-2.2.4.min.js') }} "></script>
    
    <script>
    
    var image = new ol.style.Circle({
        radius: 5,
        fill: null,
        stroke: new ol.style.Stroke({color: 'red', width: 1})
      });

      var styles = {
        'Point': new ol.style.Style({
          image: image
        }),
        'LineString': new ol.style.Style({
          stroke: new ol.style.Stroke({
            color: 'green',
            width: 1
          })
        }),
        'MultiLineString': new ol.style.Style({
          stroke: new ol.style.Stroke({
            color: 'green',
            width: 1
          })
        }),
        'MultiPoint': new ol.style.Style({
          image: image
        }),
        'MultiPolygon': new ol.style.Style({
          stroke: new ol.style.Stroke({
            color: 'yellow',
            width: 1
          }),
          fill: new ol.style.Fill({
            color: 'rgba(255, 255, 0, 0.1)'
          })
        }),
        'Polygon': new ol.style.Style({
          stroke: new ol.style.Stroke({
            color: 'blue',
            lineDash: [4],
            width: 3
          }),
          fill: new ol.style.Fill({
            color: 'rgba(0, 0, 255, 0.1)'
          })
        }),
        'GeometryCollection': new ol.style.Style({
          stroke: new ol.style.Stroke({
            color: 'magenta',
            width: 2
          }),
          fill: new ol.style.Fill({
            color: 'magenta'
          }),
          image: new ol.style.Circle({
            radius: 10,
            fill: null,
            stroke: new ol.style.Stroke({
              color: 'magenta'
            })
          })
        }),
        'Circle': new ol.style.Style({
          stroke: new ol.style.Stroke({
            color: 'red',
            width: 2
          }),
          fill: new ol.style.Fill({
            color: 'rgba(255,0,0,0.2)'
          })
        })
      };

      var styleFunction = function(feature) {
        return styles[feature.getGeometry().getType()];
      };
      
    var latitude = 118.40;
    var longitude = 29.86;


    var map = new ol.Map({
        target: 'map',
        layers: [
            new ol.layer.Tile({
                source: new ol.source.OSM()
            })
        ],
        view: new ol.View({
            center: ol.proj.transform([latitude, longitude], 'EPSG:4326', 'EPSG:3857'),
            zoom: 12
            // maxZoom: 17
        })
    });
    var view = map.getView();
    
    var geoJSONFormat = new ol.format.GeoJSON({
		'defaultDataProjection': 'EPSG:4326' // view.getProjection()
	});
    
    //var source = new ol.source.GeoJSON({
	//	projection: view.getProjection()
	//});

    var source = new ol.source.Vector({
      features: (new ol.format.GeoJSON())
    });
    

    var layer = new ol.layer.Vector({
        title:'dlzxc',
        source: source,
        style: styleFunction
    });
    
    map.addLayer(layer);
    
    $.ajax({
		url: dlzxcUrl,
		type: 'GET',
		dataType: 'json',
		contentType: 'application/json',
		mimeType: 'application/json',
		success: function (data) {
			var features = geoJSONFormat.readFeatures(data.result);
			console.log(features);
			source.addFeatures(features);
		},
		error: function (data, status, er) {
			console.log(er);
		}
	});
    
      
      
      
    </script>
    
    {% endblock %}
